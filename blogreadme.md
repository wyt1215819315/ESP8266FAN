## 代码开源地址

https://github.com/wyt1215819315/ESP8266FAN

### 主要功能

1. 风扇三挡风速控制
2. 摇头电机控制
3. 风速状态和摇头状态LED反馈
4. 按键控制
5. OTA升级
6. 小爱&天猫精灵全功能支持
7. 蜂鸣器操作反馈
8. 断点记忆功能，默认代码注释了电源状态记忆，可自行修改为来电自启

不支持红外遥控

## 过程

最近家里电风扇的主控板坏了，手头正好有几块esp8266，就想着用这个板子做一块控制板

然后拆了看，原来的控制板是这样的，图为后拍的，拆了一部分元件

![image-20220711195706569](https://static.oldwu.top/img/image-20220711195706569.png)

控制电路由四个可控硅控制，通电电源指示正常，开关也没坏，就是不开机，红外遥控偶尔能用，这个单片机也不知道怎么重新刷写程序，干脆直接推翻重来使用nodemcu来替代他，顺便支持wifi控制

## 确定方案

因为本人对电路方面也不太懂，可控硅驱动电机其实早就够了，但是安全考虑，还是用了成本高的继电器（怕接错直接把esp8266烧了），遂淘宝购买四组的继电器成品控制板，支持高低电平控制，十几块钱包邮，三组控制风扇电机，一组控制摇头电机，不会设计电路板，直接一堆线连==

软件基于blinker开发，并且加入了小爱和天猫控制的代码，怕自己写出bug，所以支持了OTA升级

![image-20220711200453441](https://static.oldwu.top/img/image-20220711200453441.png)

板子的做功还是很好的，并且有led指示，其实可以直接用板子上的led来当成风速指示，但是程序之前已经写好了，就算了

然后搞了个220v转5v的开关电源，1A足够，四个继电器同时开也不会超过3w，当然实际最多也只可能用到2个继电器

蜂鸣器使用有源蜂鸣器，有电压直接能响的那种，原来主板上拆下来的是无源蜂鸣器，加电响不了

将原来的五个开关移到小洞洞板上，因为esp8266使用常规的方法没有那么多组输出，因此简化了开关，五个开关分为两组，分别为 `开/关/风速`和`摇头`

led使用板载led作为主led，然后另外接一条作为摇头led 

继电器板的四个继电器输入并联，因为都是220v

![image-20220711201352875](https://static.oldwu.top/img/image-20220711201352875.png)

低压部分接好后的样子，线乱的一批

![image-20220711201557522](https://static.oldwu.top/img/image-20220711201557522.png)

风扇电机部分是自带电容的，因此输出也无需接电容

![image-20220711201710858](https://static.oldwu.top/img/image-20220711201710858.png)

然后装起来，因为电源模块离按键板会比较近，因此背面拿青稞纸做了绝缘

![image-20220711201913252](https://static.oldwu.top/img/image-20220711201913252.png) 

装好后的样子，功能一切正常，测试小爱和天猫精灵正常控制，结束
